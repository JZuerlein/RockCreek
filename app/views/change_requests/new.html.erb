<h1>New change request</h1>

<%= form_for(@change_request) do |f| %>
    <% if @change_request.errors.any? %>
        <div id="error_explanation">
          <h2><%= pluralize(@change_request.errors.count, "error") %> prohibited this change_request from being saved:</h2>

          <ul>
            <% @change_request.errors.full_messages.each do |msg| %>
                <li><%= msg %></li>
            <% end %>
          </ul>
        </div>
    <% end %>

    <div class="field">
      <%= f.label :requester_id %><br />
      <%= f.collection_select :requester_id, User.find_all_by_tenant_id(Tenant.current_id).sort_by(&:full_name), :id, :full_name, include_blank: false %>
    </div>

    <div class="field">
      <%= f.label :request_date %><br />
      <%= f.date_select :request_date %>
    </div>

    <div class="field">
      <%= f.label :status %><br />
      <%= f.collection_select :status, Status.all.sort_by(&:name), :name, :name, include_blank: false, :disabled => true %>
    </div>
    <div class="field">
      <%= f.label :summary %><br />
      <%= f.text_field :summary %>
    </div>
    <% if @change_request.status == ("New" || "Recall") %>
        <div class="field">
          <%= f.label :description %><br />
          <%= f.text_area :description, :size => "50x10" %>
        </div>
    <% else %>
        <div class="field">
          <%= f.label :description %><br />
          <%= f.text_area :description, :size => "50x10", :disabled => true %>
        </div>
    <% end %>
    <div class="field">
      <%= f.label :change_type %><br />
      <%= f.collection_select :change_type, ChangeType.all.sort_by(&:name), :name, :name, include_blank: false %>
    </div>
    <div class="field">
      <%= f.label :assigned_to %><br />
      <%= f.collection_select :assigned_to, User.find_all_by_tenant_id(Tenant.current_id).sort_by(&:full_name), :id, :full_name, include_blank: false %>
    </div>
    <div class="field">
      <%= f.label :due_date %><br />
      <%= f.date_select :due_date %>
    </div>
    <div class="field">
      Responses:
      <ul>
        <% @change_request.request_responses.each do |request_response| %>
            <li>
              <% if request_response.response != nil %>
                  <%= User.find_by_id(request_response.user_id).full_name + "'s response was " + request_response.response + "."  %>
              <% else %>
                  <%= User.find_by_id(request_response.user_id).full_name + " has not responded yet." %>
              <% end %>
            </li>
        <% end %>
      </ul>
    </div>
    <div class="actions">
      Actions:
      <ul>
        <li><%= f.submit %></li>
        <li><%= link_to 'Back', change_requests_path %></li>
      </ul>
    </div>
<% end %>



